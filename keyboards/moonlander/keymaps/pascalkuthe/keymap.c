// vim: nowrap

#include "keycodes.h"
#include "keymap_us.h"
#include "quantum_keycodes.h"
#include "send_string_keycodes.h"
#include QMK_KEYBOARD_H
#include "version.h"
#include "features/achordion.h"

// Home row mods for Magic Sturdy layer.
#define HOME_A LT(L_SYMB, KC_A)
#define HOME_S LT(L_NAV, KC_S)
#define HOME_D LSFT_T(KC_D)
#define HOME_F LCTL_T(KC_F)
#define HOME_QT LT(L_NUM, KC_QUOTE)
#define HOME_L LALT_T(KC_L)
#define HOME_K LSFT_T(KC_K)
#define HOME_Z LT(L_SYS, KC_Z)
#define HOME_J LCTL_T(KC_J)
#define HOME_SC LT(L_SYS, KC_SLASH)

enum custom_keycodes {
    AE = SAFE_RANGE,
    OE,
    UE,
    SS,
};

bool process_record_user(uint16_t keycode, keyrecord_t* record) {
    if (!process_achordion(keycode, record)) {
        return false;
    }
    switch (keycode) {
        case AE:
            if (record->event.pressed) {
                // when keycode QMKURL is pressed
                SEND_STRING(SS_RALT("a\""));
            } else {
                // when keycode QMKURL is released
            }
            break;
        case OE:
            if (record->event.pressed) {
                // when keycode QMKURL is pressed
                SEND_STRING(SS_RALT("o\""));
            } else {
                // when keycode QMKURL is released
            }
            break;
        case UE:
            if (record->event.pressed) {
                // when keycode QMKURL is pressed
                SEND_STRING(SS_RALT("u\""));
            } else {
                // when keycode QMKURL is released
            }
            break;
        case SS:
            if (record->event.pressed) {
                // when keycode QMKURL is pressed
                SEND_STRING(SS_RALT("ss"));
            } else {
                // when keycode QMKURL is released
            }
            break;
    }

    return true;
}

enum layers {
    L_BASE,
    L_SYMB,
    L_NUM,
    L_UNICODE,
    L_NAV,
    L_SYS,
};

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [L_BASE] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
         KC_DELETE,       KC_1,          KC_2,        KC_3,    KC_4,       KC_5,       KC_HOME,       KC_END,      KC_6,     KC_7,     KC_8,       KC_9,         KC_0,       KC_RIGHT_ALT,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
         KC_DELETE,        KC_Q,          KC_W,        KC_E,    KC_R,      KC_T,       KC_AMPR,      KC_PIPE,      KC_Y,     KC_U,     KC_I,       KC_O,         KC_P,      KC_RIGHT_ALT,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          KC_ESC,        HOME_A,        HOME_S,      HOME_D,  HOME_F,      KC_G,      KC_LBRC,      KC_RBRC,       KC_H,    HOME_J,   HOME_K,      HOME_L,      HOME_QT,  OSL(L_UNICODE),
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
         CW_TOGG,        HOME_Z,        KC_X,        KC_C,    KC_V,       KC_B,                                   KC_N,     KC_M,   KC_COMMA,    KC_DOT,       HOME_SC,    OSM(MOD_RSFT),
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
       KC_LEFT_GUI,    KC_LEFT_GUI,   KC_LEFT_GUI,  KC_LBRC,LT(L_SYMB,KC_TAB),G(KC_LEFT),                   G(KC_RIGHT),LT(L_NAV,KC_ENTER),KC_RCBR,  KC_SLASH,     KC_SLASH,    KC_SLASH,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                           KC_SPACE,    LT(L_SYMB,KC_TAB), KC_LEFT_ALT,           TG(L_NUM), LT(L_NAV,KC_ENTER), KC_BACKSPACE
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),

  [L_NAV] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,      _______,      _______,     _______, _______,  _______,     _______,     _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,      _______,      _______,      _______, KC_HOME,KC_PAGE_UP,   KC_PGDN,     KC_END,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,      _______,      _______, _______,    _______,    _______,       _______,     _______,  KC_LEFT,  KC_DOWN,      KC_UP,     KC_RIGHT,     _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,                                 _______, KC_MS_WH_UP,KC_MS_WH_DOWN, KC_MS_BTN1,     _______,      _______,
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,                                 _______, _______,  _______,    _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                            _______,           _______,          _______,              _______,       _______,           _______
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),
  [L_SYMB] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,       _______,    _______,  _______,   _______,      _______,     _______,     _______,   _______,  _______,   _______,      _______,       _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,       _______,    _______, KC_SEMICOLON,  _______,     _______,      _______,       KC_AT,KC_COLON, KC_LCBR,    KC_RCBR,    KC_GRAVE,       _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,       _______,    _______, KC_PIPE,     _______,    _______,         _______,   KC_QUESTION,KC_UNDERSCORE,KC_LPRN,   KC_RPRN,    KC_COLON,   _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
         _______,       _______,        _______,    _______, KC_TILDE,_______,                                  KC_DLR, KC_EXCLAIM, KC_LBRC,   KC_RBRC,     KC_CIRC,    _______,
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,       _______,    _______, _______,   _______,                                  _______,  _______,  _______,    _______,      _______,       _______,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                            _______,           _______,          _______,             KC_QUOTE,      _______,       KC_DOUBLE_QUOTE
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),
  [L_NUM] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,      _______,       _______,    _______, _______,  _______,      _______,     _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,        KC_MINUS,      KC_7,       KC_8,    KC_9,    KC_HASH,        _______,       _______,    _______, KC_PERC,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,        KC_EQL,        KC_4,       KC_5,    KC_6,     KC_0,      _______,       _______,    _______, KC_AMPR,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,        KC_PLUS,       KC_1,       KC_2,    KC_3,    KC_BACKSLASH,                                  _______, KC_ASTERISK, _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,        _______,   _______, _______,    _______,                                _______,KC_LEFT_GUI,_______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                            _______,         _______,           _______,               _______,       _______,          _______
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),
  [L_UNICODE] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
           _______,       _______,       _______,   _______, _______,    _______,      _______,       _______,    _______, _______,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
           _______,       _______,       _______,   _______, _______,    _______,      _______,       _______,    _______,UE, _______,   OE,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
           _______,    AE,       SS,     _______, _______,    _______,      _______,       _______,    _______, _______,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
           _______,       _______,       _______,   _______, _______,    _______,                                 _______, _______,  _______,     _______,     _______,      _______,
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
           _______,       _______,       _______,   _______, _______,    _______,                                 _______, _______,  _______,  _______, _______,   _______,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                            _______,          _______,     _______,         _______,        _______,          _______
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),
  [L_SYS] = LAYOUT_moonlander(
    // _________________________________________________________________________________________________________________________________________________________________________________
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,       _______,    _______, _______,     _______,     _______,       _______,    _______, _______,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       _______,       G(KC_7),     G(KC_8), G(KC_9),     _______,     _______,     _______,      _______, G(KC_AMPR),G(KC_ASTR), G(KC_LPRN),   _______,      _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |           | |             |         |        |          |             |             |             |
          _______,       G(KC_Q),       G(KC_4),     G(KC_5), G(KC_6),    _______,     _______,       _______,    _______, G(KC_DLR),G(KC_PERC), G(KC_CIRC), G(KC_SEMICOLON),     _______,
    //|______________|______________|______________|________|________|______________|___________| |_____________|_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,       G(KC_1),     G(KC_2), G(KC_3),     _______,                                _______, G(KC_EXCLAIM), G(KC_AT), G(KC_HASH), _______,      _______,
    //|______________|______________|______________|________|________|______________|                           |_________|________|__________|_____________|_____________|_____________|
    //|              |              |              |        |        |              |                           |         |        |          |             |             |             |
          _______,       _______,       _______,    _______, _______,  LSG(KC_PAGE_UP),                LSG(KC_PAGE_DOWN), _______,  _______,     _______,      _______,      _______,
    //|______________|______________|______________|________|________|______________|_________       ___________|_________|________|__________|_____________|_____________|_____________|
    //                                |                  |                |                   |     |           |                  |                |
                                       G(KC_PAGE_UP),       _______,          _______,               _______,      _______,        G(KC_PAGE_DOWN)
    //                                |__________________|________________|___________________|     |___________|__________________|________________|
  ),
};
// clang-format on

uint16_t active_sticky_mod         = 0;
uint16_t sticky_mod_timer          = 0;
bool     active_sticky_mod_pressed = false;
int      ss_waitms                 = 20;

bool get_hold_on_other_key_press(uint16_t keycode, keyrecord_t* record) {
    switch (keycode) {
        case LSFT_T(KC_TAB):
        case LSFT_T(KC_BACKSPACE):
            return true;
        default:
            return false;
    }
}

void matrix_scan_user(void) {
    achordion_task();
}

void leader_end_user(void) {
    if (leader_sequence_two_keys(KC_C, KC_B)) {
        SEND_STRING_DELAY("```" SS_LSFT("\n\n") "```" SS_TAP(X_UP), ss_waitms);

    } else if (leader_sequence_four_keys(KC_C, KC_B, KC_P, KC_P)) {
        SEND_STRING_DELAY(SS_LSFT("\n\n") "```" SS_LSFT("\n\n") "```" SS_TAP(X_UP) SS_LCTL(SS_TAP(X_V)), ss_waitms);

    } else if (leader_sequence_three_keys(KC_C, KC_B, KC_P)) {
        SEND_STRING_DELAY("```" SS_LSFT("\n\n") "```" SS_TAP(X_UP) SS_LCTL(SS_TAP(X_V)), ss_waitms);
    }

    else if (leader_sequence_three_keys(KC_L, KC_S, KC_L)) {
        SEND_STRING_DELAY("ls -alh\n", ss_waitms);

    } else if (leader_sequence_three_keys(KC_A, KC_L, KC_S)) {
        SEND_STRING_DELAY("aws s3 ls --human ", ss_waitms);

    } else if (leader_sequence_two_keys(KC_T, KC_M)) {
        SEND_STRING_DELAY("tmux a || tmux\n", ss_waitms);
    }

    // disable bracketed paste
    else if (leader_sequence_two_keys(KC_B, KC_P)) {
        SEND_STRING_DELAY("printf \"\\e[?2004l\"\n", ss_waitms);
    }

    // enable bracketed paste
    else if (leader_sequence_three_keys(KC_B, KC_P, KC_P)) {
        SEND_STRING_DELAY("printf \"\\e[?2004h\"\n", ss_waitms);
    }

    else if (leader_sequence_two_keys(KC_S, KC_U)) {
        SEND_STRING_DELAY("sudo -i\n", ss_waitms);

    } else if (leader_sequence_two_keys(KC_P, KC_S)) {
        SEND_STRING_DELAY("ps -aefH", ss_waitms);

    } else if (leader_sequence_three_keys(KC_P, KC_S, KC_L)) {
        SEND_STRING_DELAY("ps -aefH | less\n", ss_waitms);
    }

    else if (leader_sequence_three_keys(KC_T, KC_A, KC_I)) {
        SEND_STRING_DELAY("tai64nlocal", ss_waitms);

    } else if (leader_sequence_two_keys(KC_T, KC_A)) {
        SEND_STRING_DELAY("tail -F  | tai64nlocal" SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT) SS_TAP(X_LEFT), ss_waitms);

    } else if (leader_sequence_two_keys(KC_P, KC_U)) {
        SEND_STRING_DELAY("/etc/puppet/bin/puppet", ss_waitms);
    }

    else if (leader_sequence_two_keys(KC_O, KC_S)) {
        SEND_STRING_DELAY("source /opt/SGraph/scripts/oozie-env.sh\n", ss_waitms);

    } else if (leader_sequence_three_keys(KC_O, KC_J, KC_I)) {
        SEND_STRING_DELAY("oozie job -info '" SS_LSFT(SS_LCTL("v")) "'\n", ss_waitms);

    } else if (leader_sequence_three_keys(KC_O, KC_J, KC_S)) {
        SEND_STRING_DELAY("oozie jobs -jobtype ", ss_waitms);

    } else if (leader_sequence_two_keys(KC_Y, KC_L)) {
        SEND_STRING_DELAY("yarn logs -applicationId '" SS_LSFT(SS_LCTL("v")) "'\n", ss_waitms);
    }

    else if (leader_sequence_three_keys(KC_J, KC_Q, KC_L)) {
        SEND_STRING_DELAY("jq -C '.' | less -R\n", ss_waitms);

    } else if (leader_sequence_two_keys(KC_E, KC_M)) {
        SEND_STRING_DELAY("skyler@dead10ck.dev", ss_waitms);
    }
}

void sticky_mod(uint16_t mod_key, uint16_t keycode, keyrecord_t* record) {
    if (record->event.pressed) {
        if (active_sticky_mod && active_sticky_mod != mod_key) {
            unregister_code(active_sticky_mod);
            active_sticky_mod = 0;
        }

        if (!active_sticky_mod) {
            register_code(mod_key);
            active_sticky_mod = mod_key;
        }

        sticky_mod_timer = timer_read();
        tap_code(keycode);
        active_sticky_mod_pressed = true;
    } else {
        // start the timer again when we release
        sticky_mod_timer = timer_read();

        // we've already released it
        active_sticky_mod_pressed = false;
    }
}

extern rgb_config_t rgb_matrix_config;

const uint8_t PROGMEM ledmap[][RGB_MATRIX_LED_COUNT][3] = {
    [L_BASE] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {131, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},

    [L_SYMB] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 245, 245}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {131, 255, 255}, {131, 255, 255}, {131, 255, 255}, {0, 0, 0}, {131, 255, 255}, {131, 255, 255}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},

    [L_NUM] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {131, 255, 255}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 245, 245}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},

    [L_NAV] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {0, 0, 0}, {0, 245, 245}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},

    [L_UNICODE] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {74, 255, 206}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {74, 255, 206}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {123, 218, 204}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 206}, {0, 245, 245}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 206}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {24, 255, 255}, {24, 255, 255}, {24, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},

    [L_SYS] = {{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {131, 255, 255}, {131, 255, 255}, {131, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {74, 255, 255}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {74, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 245, 245}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {123, 218, 204}, {123, 218, 204}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}},
};

void set_layer_color(int layer) {
    for (int i = 0; i < RGB_MATRIX_LED_COUNT; i++) {
        HSV hsv = {
            .h = pgm_read_byte(&ledmap[layer][i][0]),
            .s = pgm_read_byte(&ledmap[layer][i][1]),
            .v = pgm_read_byte(&ledmap[layer][i][2]),
        };
        if (!hsv.h && !hsv.s && !hsv.v) {
            rgb_matrix_set_color(i, 0, 0, 0);
        } else {
            RGB   rgb = hsv_to_rgb(hsv);
            float f   = (float)rgb_matrix_config.hsv.v / UINT8_MAX;
            rgb_matrix_set_color(i, f * rgb.r, f * rgb.g, f * rgb.b);
        }
    }
}

void keyboard_post_init_user(void) {
    rgb_matrix_enable();
}

bool rgb_matrix_indicators_user(void) {
    if (keyboard_config.disable_layer_led) {
        return false;
    }

    switch (biton32(layer_state)) {
        case L_BASE:
            set_layer_color(L_BASE);
            break;
        case L_SYMB:
            set_layer_color(L_SYMB);
            break;
        case L_NUM:
            set_layer_color(L_NUM);
            break;
        case L_NAV:
            set_layer_color(L_NAV);
            break;
        case L_UNICODE:
            set_layer_color(L_UNICODE);
            break;
        default:
            if (rgb_matrix_get_flags() == LED_FLAG_NONE) rgb_matrix_set_color_all(0, 0, 0);
            break;
    }

    return false;
}

bool achordion_chord(uint16_t tap_hold_keycode, keyrecord_t* tap_hold_record, uint16_t other_keycode, keyrecord_t* other_record) {
    // Exceptionally consider the following chords as holds, even though they
    // are on the same hand
    switch (tap_hold_keycode) {
        case HOME_QT: // A + U.
            if (other_keycode == HOME_J) {
                return true;
            }
            if (other_keycode == KC_M) {
                return true;
            }
            if (other_keycode == KC_U) {
                return true;
            }
            break;

        case HOME_A: // A + U.
            if (other_keycode == HOME_F) {
                return true;
            }
            if (other_keycode == KC_V) {
                return true;
            }
            if (other_keycode == KC_R) {
                return true;
            }
            break;
    }

    // Otherwise, follow the opposite hands rule.
    return achordion_opposite_hands(tap_hold_record, other_record);
}